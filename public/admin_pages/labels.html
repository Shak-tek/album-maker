<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>print labels</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* print styles */
    @media print {
      .no-print { display: none !important; }
      body { background: #fff !important; }
      @page { size: A4; margin: 10mm; }
      /* 2 columns x 3 rows layout on A4 */
      .print-sheet {
        column-count: 2;
        column-gap: 10mm;
      }
      .label {
        break-inside: avoid;
        height: 95mm;  /* ~ A6 minus margins to fit 3 rows */
        border: 1px solid #000;
        padding: 8mm;
        margin: 0 0 10mm 0;
      }
    }
  </style>
</head>
<body class="bg-gradient-to-br from-gray-50 to-gray-100 antialiased text-gray-800">

<!-- slide-in menu -->
<div id="sidebar" class="fixed inset-y-0 left-0 w-64 bg-white shadow-xl transform -translate-x-full transition-transform duration-300 z-50">
  <div class="p-6 border-b flex justify-between items-center">
    <span class="text-lg text-indigo-600">menu</span>
    <button id="closeMenu" class="text-gray-600 hover:text-indigo-600" aria-label="close menu">&times;</button>
  </div>
  <nav class="p-4 space-y-3">
    <a href="dashboard.html" class="block px-3 py-2 rounded-lg text-gray-700 hover:bg-indigo-50 hover:text-indigo-700">dashboard</a>
    <a href="funnel.html" class="block px-3 py-2 rounded-lg text-gray-700 hover:bg-indigo-50 hover:text-indigo-700">order funnel</a>
    <a href="orders.html" class="block px-3 py-2 rounded-lg text-gray-700 hover:bg-indigo-50 hover:text-indigo-700">orders</a>
    <a href="labels.html" class="block px-3 py-2 rounded-lg text-gray-700 hover:bg-indigo-50 hover:text-indigo-700">print labels</a>
  </nav>
</div>
<div id="overlay" class="fixed inset-0 bg-black/40 hidden z-40"></div>

<!-- page header -->
<div class="p-6 flex items-center gap-4 no-print">
  <button id="openMenu" class="p-2 rounded-md hover:bg-indigo-100 text-gray-600 hover:text-indigo-700" aria-label="open menu">
    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
    </svg>
  </button>
  <div class="text-2xl text-indigo-700">print labels</div>
</div>

<!-- controls -->
<div class="px-6 no-print">
  <div class="bg-white rounded-2xl shadow-md p-4">
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-4">
      <div class="grid grid-cols-2 md:grid-cols-5 gap-3 lg:col-span-2">
        <div class="md:col-span-2">
          <label class="text-xs text-gray-500">search</label>
          <input id="q" type="text" placeholder="order id, name, phone, city" class="w-full mt-1 border rounded-md p-2 shadow-sm focus:ring-2 focus:ring-indigo-400"/>
        </div>
        <div>
          <label class="text-xs text-gray-500">city</label>
          <input id="fCity" type="text" placeholder="city" class="w-full mt-1 border rounded-md p-2 shadow-sm focus:ring-2 focus:ring-indigo-400"/>
        </div>
        <div>
          <label class="text-xs text-gray-500">status</label>
          <select id="fStatus" class="w-full mt-1 border rounded-md p-2 shadow-sm focus:ring-2 focus:ring-indigo-400">
            <option value="">ready for Packing</option>
            <option value="in printing">in printing</option>
            <option value="out for delivery">Ready for delivery</option>
          </select>
        </div>
        <div>
          <label class="text-xs text-gray-500">carrier</label>
          <select id="fCarrier" class="w-full mt-1 border rounded-md p-2 shadow-sm focus:ring-2 focus:ring-indigo-400">
            <option value="">any</option>
            <option value="leopard">leopard</option>
            <option value="tcs">tcs</option>
            <option value="dhl">dhl</option>
          </select>
        </div>
        <div>
          <label class="text-xs text-gray-500">label size</label>
          <select id="fSize" class="w-full mt-1 border rounded-md p-2 shadow-sm focus:ring-2 focus:ring-indigo-400">
            <option value="a6">a6 (half a5)</option>
            <option value="a7">a7 (small)</option>
          </select>
        </div>
        <div class="md:col-span-2 flex items-end gap-2">
          <button id="apply" class="px-3 py-2 rounded-md bg-indigo-600 text-white hover:bg-indigo-700">apply</button>
          <button id="reset" class="px-3 py-2 rounded-md bg-gray-100 text-gray-700 hover:bg-gray-200">reset</button>
        </div>
      </div>

      <div class="flex items-end gap-2 lg:justify-end">
        <button id="addSelected" class="px-3 py-2 rounded-md bg-emerald-600 text-white hover:bg-emerald-700">add selected to print sheet</button>
        <button id="printNow" class="px-3 py-2 rounded-md bg-gray-800 text-white hover:bg-black">print</button>
      </div>
    </div>
  </div>
</div>

<!-- orders to choose -->
<div class="px-6 mt-4 no-print">
  <div class="bg-white p-6 rounded-2xl shadow-md">
    <div class="text-lg text-gray-700 mb-3">select orders</div>
    <div class="overflow-x-auto">
      <table class="min-w-full text-sm text-left border-separate border-spacing-y-2">
        <thead class="bg-indigo-100 text-indigo-700">
          <tr>
            <th class="p-2"><input type="checkbox" id="selectAll"/></th>
            <th class="p-2">order id</th>
            <th class="p-2">full name</th>
            <th class="p-2">phone</th>
            <th class="p-2">city</th>
            <th class="p-2">address</th>
            <th class="p-2">status</th>
            <th class="p-2">carrier</th>
            <th class="p-2">album size</th>
          </tr>
        </thead>
        <tbody id="ordersTbody">
          <!-- rows injected -->
        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- sheet preview -->
<div class="px-6 mt-6">
  <div class="bg-white p-6 rounded-2xl shadow-md">
    <div class="flex items-center justify-between no-print">
      <div class="text-lg text-gray-700">print sheet preview</div>
      <div class="text-sm text-gray-500">screen preview uses card grid; printed layout is 2x3 per page</div>
    </div>

    <!-- on screen grid -->
    <div id="screenGrid" class="mt-4 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 no-print">
      <!-- labels injected -->
    </div>

    <!-- print sheet (hidden on screen, used only for printing) -->
    <div id="printSheet" class="print-sheet" style="display:none">
      <!-- labels injected -->
    </div>
  </div>
</div>

<!-- small helper: label template styles for screen -->
<style>
  .label-card {
    border-radius: 16px;
    border: 1px dashed #e5e7eb;
    background: #fff;
    padding: 16px;
  }
  .fake-barcode {
    letter-spacing: 3px;
    font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
  }
  .qr {
    width: 60px; height: 60px;
    background:
      linear-gradient(90deg,#000 50%,transparent 50%) 0 0/10px 10px,
      linear-gradient(#000 50%,transparent 50%) 0 0/10px 10px;
    border: 4px solid #000;
  }
</style>

<script>
  // sample orders dataset
  const orders = [
    {id:'#3001', name:'aisha khan', phone:'+92 300 1111111', city:'karachi', address:'house 12, block a, gulshan-e-iqbal', status:'Ready for delivery ', carrier:'leopard', size:'large'},
    {id:'#3002', name:'bilal ahmed', phone:'+92 301 2222222', city:'lahore', address:'34 main boulevard, dha phase 3', status:'Ready for delivery', carrier:'tcs', size:'medium'},
    {id:'#3003', name:'danish raza', phone:'+92 302 3333333', city:'islamabad', address:'street 7, f-7/2', status:'Ready for delivery', carrier:'tcs', size:'large'},
    {id:'#3004', name:'eman ali', phone:'+92 303 4444444', city:'rawalpindi', address:'house 9, satellite town', status:'in printing', carrier:'leopard', size:'small'},
    {id:'#3005', name:'fatima noor', phone:'+92 304 5555555', city:'faisalabad', address:'plot 22, people colony', status:'ready to pack', carrier:'dhl', size:'medium'},
    {id:'#3006', name:'hassan javed', phone:'+92 305 6666666', city:'multan', address:'house 88, gulgasht', status:'ready to pack', carrier:'leopard', size:'large'},
    {id:'#3007', name:'iqra saleem', phone:'+92 306 7777777', city:'peshawar', address:'street 3, hayyatabad', status:'ready to pack', carrier:'tcs', size:'small'},
    {id:'#3008', name:'javeria aslam', phone:'+92 307 8888888', city:'quetta', address:'house 15, zarghoon road', status:'ready to pack', carrier:'dhl', size:'large'},
    {id:'#3009', name:'kashif mehmood', phone:'+92 308 9999999', city:'sialkot', address:'street 2, cantt', status:'ready to pack', carrier:'leopard', size:'medium'},
    {id:'#3010', name:'laiba tariq', phone:'+92 309 1234567', city:'hyderabad', address:'block c, latifabad', status:'ready to pack', carrier:'tcs', size:'small'},
    {id:'#3011', name:'murtaza ali', phone:'+92 310 2222333', city:'gujranwala', address:'near civil lines', status:'ready to pack', carrier:'leopard', size:'medium'},
    {id:'#3012', name:'noor fatima', phone:'+92 311 4444666', city:'sargodha', address:'model town', status:'ready to pack', carrier:'dhl', size:'large'},
  ];

  // state
  let selected = new Set();
  let filtered = [...orders];

  // menu
  const sidebar = document.getElementById('sidebar');
  const overlay = document.getElementById('overlay');
  document.getElementById('openMenu').addEventListener('click', () => {
    sidebar.classList.remove('-translate-x-full'); overlay.classList.remove('hidden');
  });
  document.getElementById('closeMenu').addEventListener('click', () => {
    sidebar.classList.add('-translate-x-full'); overlay.classList.add('hidden');
  });
  overlay.addEventListener('click', () => {
    sidebar.classList.add('-translate-x-full'); overlay.classList.add('hidden');
  });

  // render orders table
  const tbody = document.getElementById('ordersTbody');
  function renderTable() {
    tbody.innerHTML = '';
    filtered.forEach(o => {
      const tr = document.createElement('tr');
      tr.className = 'bg-gray-50 hover:bg-gray-100 transition';
      tr.innerHTML = `
        <td class="p-2"><input type="checkbox" data-id="${o.id}" ${selected.has(o.id)?'checked':''}/></td>
        <td class="p-2">${o.id}</td>
        <td class="p-2">${o.name}</td>
        <td class="p-2">${o.phone}</td>
        <td class="p-2">${o.city}</td>
        <td class="p-2">${o.address}</td>
        <td class="p-2 ${o.status==='ready to pack'?'text-amber-600':'text-gray-600'}">${o.status}</td>
        <td class="p-2">${o.carrier}</td>
        <td class="p-2">${o.size}</td>
      `;
      tbody.appendChild(tr);
    });
  }

  // filters
  function applyFilters() {
    const q = document.getElementById('q').value.trim().toLowerCase();
    const city = document.getElementById('fCity').value.trim().toLowerCase();
    const status = document.getElementById('fStatus').value;
    const carrier = document.getElementById('fCarrier').value;
    const size = document.getElementById('fSize').value;

    filtered = orders.filter(o => {
      const qmatch = !q || [o.id,o.name,o.phone,o.city,o.address].join(' ').toLowerCase().includes(q);
      const cmatch = !city || o.city.toLowerCase().includes(city);
      const smatch = !status || o.status === status || (status==='' && o.status==='ready to pack');
      const camatch = !carrier || o.carrier === carrier;
      const sizematch = !size || size==='a6' || size==='a7'; // label size is a sheet option, not per order
      return qmatch && cmatch && smatch && camatch && sizematch;
    });
    renderTable();
  }

  document.getElementById('apply').addEventListener('click', applyFilters);
  document.getElementById('reset').addEventListener('click', () => {
    ['q','fCity'].forEach(id => document.getElementById(id).value='');
    document.getElementById('fStatus').value='';
    document.getElementById('fCarrier').value='';
    document.getElementById('fSize').value='a6';
    selected.clear();
    filtered = [...orders];
    renderTable();
  });

  // selection
  tbody.addEventListener('change', (e) => {
    const cb = e.target.closest('input[type="checkbox"][data-id]');
    if (!cb) return;
    const id = cb.getAttribute('data-id');
    cb.checked ? selected.add(id) : selected.delete(id);
  });
  document.getElementById('selectAll').addEventListener('change', (e) => {
    const check = e.target.checked;
    filtered.forEach(o => check ? selected.add(o.id) : selected.delete(o.id));
    renderTable();
    e.target.checked = check;
  });

  // build labels
  const screenGrid = document.getElementById('screenGrid');
  const printSheet = document.getElementById('printSheet');

  function makeLabelHTML(o) {
    const shipFrom = 'photo album co.\nwarehouse 2, lahore\nsupport: 0300-0000000';
    const barcode = (o.id.replace('#','') + 'PAK').split('').join(' ');
    return `
      <div class="label-card">
        <div class="flex items-start justify-between">
          <div class="text-indigo-600">photo album co.</div>
          <div class="text-xs text-gray-500">carrier: ${o.carrier}</div>
        </div>

        <div class="mt-3 grid grid-cols-2 gap-3">
          <div class="text-xs text-gray-600 whitespace-pre">${shipFrom}</div>
          <div class="text-xs">
            <div class="text-gray-500 mb-1">ship to</div>
            <div class="text-base text-gray-800">${o.name}</div>
            <div class="text-gray-700">${o.address}</div>
            <div class="text-gray-700">${o.city}</div>
            <div class="text-gray-700">${o.phone}</div>
          </div>
        </div>

        <div class="mt-3 grid grid-cols-3 gap-2 items-center">
          <div class="qr rounded-sm"></div>
          <div class="col-span-2">
            <div class="text-xs text-gray-500">order id</div>
            <div class="text-xl text-gray-900">${o.id}</div>
            <div class="mt-1 text-xs text-gray-500">album</div>
            <div class="text-sm text-gray-800">${o.size}</div>
          </div>
        </div>

        <div class="mt-3 p-2 rounded-md bg-gray-50 border border-dashed border-gray-200">
          <div class="text-xs text-gray-500">scan code</div>
          <div class="fake-barcode text-lg text-gray-900">${barcode}</div>
        </div>

        <div class="mt-2 text-[11px] text-gray-500">handle with care • keep dry • do not bend</div>
      </div>
    `;
  }

  function rebuildSheets() {
    // screen
    screenGrid.innerHTML = '';
    Array.from(selected).map(id => orders.find(o=>o.id===id)).forEach(o => {
      const div = document.createElement('div');
      div.innerHTML = makeLabelHTML(o);
      screenGrid.appendChild(div.firstElementChild);
    });

    // print
    printSheet.innerHTML = '';
    Array.from(selected).map(id => orders.find(o=>o.id===id)).forEach(o => {
      const div = document.createElement('div');
      div.className = 'label';
      div.innerHTML = `
        <div style="display:flex; align-items:flex-start; justify-content:space-between;">
          <div style="color:#4f46e5;">photo album co.</div>
          <div style="font-size:10px;color:#6b7280;">carrier: ${o.carrier}</div>
        </div>
        <div style="display:grid; grid-template-columns:1fr 1fr; gap:8px; margin-top:8px;">
          <div style="white-space:pre; font-size:11px; color:#6b7280;">photo album co.
warehouse 2, lahore
support: 0300-0000000</div>
          <div style="font-size:12px;">
            <div style="color:#6b7280;margin-bottom:2px;">ship to</div>
            <div style="font-size:15px;color:#111827;">${o.name}</div>
            <div style="color:#374151;">${o.address}</div>
            <div style="color:#374151;">${o.city}</div>
            <div style="color:#374151;">${o.phone}</div>
          </div>
        </div>
        <div style="display:grid; grid-template-columns:60px 1fr; gap:10px; align-items:center; margin-top:8px;">
          <div style="width:60px;height:60px;border:4px solid #000;background:
            linear-gradient(90deg,#000 50%,transparent 50%) 0 0/10px 10px,
            linear-gradient(#000 50%,transparent 50%) 0 0/10px 10px;"></div>
          <div>
            <div style="font-size:10px;color:#6b7280;">order id</div>
            <div style="font-size:18px;color:#111827;">${o.id}</div>
            <div style="margin-top:2px;font-size:10px;color:#6b7280;">album</div>
            <div style="font-size:12px;color:#111827;">${o.size}</div>
          </div>
        </div>
        <div style="margin-top:8px;border:1px dashed #e5e7eb;background:#f9fafb;padding:6px;">
          <div style="font-size:10px;color:#6b7280;">scan code</div>
          <div style="font-family:monospace;letter-spacing:3px;font-size:16px;color:#111827;">${(o.id.replace('#','')+'PAK').split('').join(' ')}</div>
        </div>
        <div style="margin-top:6px;font-size:10px;color:#6b7280;">handle with care • keep dry • do not bend</div>
      `;
      printSheet.appendChild(div);
    });
  }

  document.getElementById('addSelected').addEventListener('click', () => {
    if (selected.size === 0) {
      alert('please select at least one order');
      return;
    }
    rebuildSheets();
    // show print sheet in print mode only
    printSheet.style.display = 'none';
  });

  document.getElementById('printNow').addEventListener('click', () => {
    if (selected.size === 0) {
      alert('please add labels to the sheet first');
      return;
    }
    // ensure print container exists
    rebuildSheets();
    // make sure print DOM is present for printing
    printSheet.style.display = 'block';
    window.print();
    // hide again after printing (for screen)
    setTimeout(()=>{ printSheet.style.display = 'none'; }, 300);
  });

  // init
  renderTable();
  applyFilters();
</script>

</body>
</html>
